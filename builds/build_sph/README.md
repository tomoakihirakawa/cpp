# Contents

- [ğŸ‹Smoothed Particle Hydrodynamics (SPH) ISPH EISPH](#ğŸ‹Smoothed-Particle-Hydrodynamics-(SPH)-ISPH-EISPH)
    - [â›µï¸æ¦‚è¦](#â›µï¸æ¦‚è¦)
        - [ğŸª¸å‰æº–å‚™](#ğŸª¸å‰æº–å‚™)
        - [ğŸª¸ãƒ•ãƒ©ã‚¯ã‚·ãƒ§ãƒŠãƒ«ã‚¹ãƒ†ãƒƒãƒ—ã‚’ä½¿ã£ã¦åˆæœŸå€¤å•é¡Œã‚’è§£ã](#ğŸª¸ãƒ•ãƒ©ã‚¯ã‚·ãƒ§ãƒŠãƒ«ã‚¹ãƒ†ãƒƒãƒ—ã‚’ä½¿ã£ã¦åˆæœŸå€¤å•é¡Œã‚’è§£ã)
    - [â›µï¸ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼$`\nabla^{n+1} \cdot \left(\frac{1}{\rho^n} \nabla^{n} p^{n+1}\right) = b`$](#â›µï¸ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼$`\nabla^{n+1}-\cdot-\left(\frac{1}{\rho^n}-\nabla^{n}-p^{n+1}\right)-=-b`$)
        - [ğŸª¸ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼](#ğŸª¸ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼)
        - [ğŸª¸å³è¾ºï¼Œ$`b`$ï¼Œ`PoissonRHS`ã«ã¤ã„ã¦](#ğŸª¸å³è¾ºï¼Œ$`b`$ï¼Œ`PoissonRHS`ã«ã¤ã„ã¦)
        - [ğŸª¸å·¦è¾ºã«ã¤ã„ã¦](#ğŸª¸å·¦è¾ºã«ã¤ã„ã¦)
        - [ğŸª¸æ°´é¢ã®è¨ˆç®—è£œåŠ©ç²’å­`auxiliaryPoints`](#ğŸª¸æ°´é¢ã®è¨ˆç®—è£œåŠ©ç²’å­`auxiliaryPoints`)
        - [ğŸª¸æ¬¡æ™‚åˆ»ã®ç™ºæ•£æ¼”ç®—ï¼Œ$`\nabla^{n+1} \cdot {\bf b}^n = \sum _j \dfrac{m _j}{\rho _j^{n+1}}({\bf b} _j^n-{\bf b} _i^n)\cdot \nabla W({\bf x} _i^{n+1},{\bf x} _j^{n+1},h)`$](#ğŸª¸æ¬¡æ™‚åˆ»ã®ç™ºæ•£æ¼”ç®—ï¼Œ$`\nabla^{n+1}-\cdot-{\bf-b}^n-=-\sum-_j-\dfrac{m-_j}{\rho-_j^{n+1}}({\bf-b}-_j^n-{\bf-b}-_i^n)\cdot-\nabla-W({\bf-x}-_i^{n+1},{\bf-x}-_j^{n+1},h)`$)
        - [ğŸª¸ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼ã®ä½œæˆã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°](#ğŸª¸ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼ã®ä½œæˆã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°)
        - [ğŸª¸ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼ã®ä½œæˆ](#ğŸª¸ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼ã®ä½œæˆ)
    - [â›µï¸ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼ã®è§£æ³•](#â›µï¸ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼ã®è§£æ³•)
        - [ğŸª¸CFLæ¡ä»¶ã®è¨­å®š](#ğŸª¸CFLæ¡ä»¶ã®è¨­å®š)
    - [â›µï¸$`\nabla^2 {\bf u} _i`$ã®è¨ˆç®—](#â›µï¸$`\nabla^2-{\bf-u}-_i`$ã®è¨ˆç®—)
        - [ğŸª¸é«˜é€ŸåŒ–ã®ãŸã‚ã®å·¥å¤«](#ğŸª¸é«˜é€ŸåŒ–ã®ãŸã‚ã®å·¥å¤«)
    - [â›µï¸åœ§åŠ›å‹¾é…$`\nabla p^{n+1}`$ã®è¨ˆç®—](#â›µï¸åœ§åŠ›å‹¾é…$`\nabla-p^{n+1}`$ã®è¨ˆç®—)
    - [â›µï¸æ³¨æ„ç‚¹](#â›µï¸æ³¨æ„ç‚¹)
    - [â›µï¸å£é¢ç²’å­ã®æµé€Ÿã¨åœ§åŠ›](#â›µï¸å£é¢ç²’å­ã®æµé€Ÿã¨åœ§åŠ›)
    - [â›µï¸æ³•ç·šæ–¹å‘ã®è¨ˆç®—ã¨æ°´é¢ã®åˆ¤å®š](#â›µï¸æ³•ç·šæ–¹å‘ã®è¨ˆç®—ã¨æ°´é¢ã®åˆ¤å®š)
        - [ğŸª¸æ³•ç·šæ–¹å‘ã®è¨ˆç®—](#ğŸª¸æ³•ç·šæ–¹å‘ã®è¨ˆç®—)
        - [ğŸª¸æ°´é¢ã®åˆ¤å®š](#ğŸª¸æ°´é¢ã®åˆ¤å®š)
    - [â›µï¸æ°´é¢è£œåŠ©ç²’å­ã®ä½œæˆ](#â›µï¸æ°´é¢è£œåŠ©ç²’å­ã®ä½œæˆ)
- [ğŸ‹å®Ÿè¡Œæ–¹æ³•](#ğŸ‹å®Ÿè¡Œæ–¹æ³•)
    - [â›µï¸Bucketã‚’ç”¨ã„ãŸç²’å­æ¢ç´¢ã®ãƒ†ã‚¹ãƒˆ](#â›µï¸Bucketã‚’ç”¨ã„ãŸç²’å­æ¢ç´¢ã®ãƒ†ã‚¹ãƒˆ)
- [ğŸ‹ãƒ†ã‚¹ãƒˆ](#ğŸ‹ãƒ†ã‚¹ãƒˆ)
    - [â›µï¸æ ¸é–¢æ•°ã®ãƒ†ã‚¹ãƒˆ](#â›µï¸æ ¸é–¢æ•°ã®ãƒ†ã‚¹ãƒˆ)
    - [â›µï¸â›µï¸5æ¬¡ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³é–¢æ•°](#â›µï¸â›µï¸5æ¬¡ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³é–¢æ•°)
    - [â›µï¸â›µï¸3æ¬¡ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³é–¢æ•°](#â›µï¸â›µï¸3æ¬¡ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³é–¢æ•°)


---
# ğŸ‹Smoothed Particle Hydrodynamics (SPH) ISPH EISPH 

## â›µï¸æ¦‚è¦ 
### ğŸª¸å‰æº–å‚™ 
1. ãƒã‚±ãƒƒãƒˆã®ç”Ÿæˆ
2. æµã‚Œã®è¨ˆç®—ã«é–¢ä¸ã™ã‚‹å£ç²’å­ã‚’ä¿å­˜
3. CFLæ¡ä»¶ã‚’æº€ãŸã™ã‚ˆã†ã«ã‚¿ã‚¤ãƒ ã‚¹ãƒ†ãƒƒãƒ—é–“éš” $`\Delta t`$ã‚’è¨­å®š

### ğŸª¸ãƒ•ãƒ©ã‚¯ã‚·ãƒ§ãƒŠãƒ«ã‚¹ãƒ†ãƒƒãƒ—ã‚’ä½¿ã£ã¦åˆæœŸå€¤å•é¡Œã‚’è§£ã 

4. æ°´é¢ã®åˆ¤å®š
5. $`\nabla^2 {\bf u}`$ã®è¨ˆç®—
6. `PoissonRHS`,$`b`$ã¨$`\nabla^2 p^{n+1}`$ã«ãŠã‘ã‚‹$`p^{n+1}`$ã®ä¿‚æ•°ã®è¨ˆç®—
7. æµé€Ÿã®ç™ºæ•£ã‹ã‚‰å¯†åº¦ $`{\rho}^\ast`$ã‚’è¨ˆç®—
8. æ¬¡ã®æ™‚åˆ»ã®åœ§åŠ› $`p^{n+1}`$ã‚’è¨ˆç®—
* å£ç²’å­ã®åœ§åŠ›ã®è¨ˆç®—ï¼ˆæµä½“ç²’å­ã®ç¾åœ¨ã®åœ§åŠ›$`p^n`$ã ã‘ã‚’ä½¿ã£ã¦è¿‘ä¼¼ï¼‰
* æµä½“ç²’å­ã®åœ§åŠ›$`p^{n+1}`$ã®è¨ˆç®—
9. $`\nabla {p^{n+1}}`$ãŒè¨ˆç®—ã§ãï¼Œ $`\frac{D{\bf u}}{D t}=-\frac{1}{\rho}\nabla {p^{n+1}} + \frac{1}{\nu}\nabla^2{\bf u} + {\bf g}`$ï¼ˆç²˜æ€§ç‡ãŒä¸€å®šã®éåœ§ç¸®æ€§æµã‚Œã®åŠ é€Ÿåº¦ï¼‰ã‚’å¾—ã‚‹ï¼
10. $`\frac{D\bf u}{Dt}`$ã‚’ä½¿ã£ã¦ï¼Œæµé€Ÿã‚’æ›´æ–°ï¼æµé€Ÿã‚’ä½¿ã£ã¦ä½ç½®ã‚’æ›´æ–°


[./SPH.hpp#L211](./SPH.hpp#L211)


## â›µï¸ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼$`\nabla^{n+1} \cdot \left(\frac{1}{\rho^n} \nabla^{n} p^{n+1}\right) = b`$ 

### ğŸª¸ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼ 

æ¬¡ã®æ™‚åˆ»ã®æµã‚Œå ´ã‚’ç™ºæ•£ãªã—$`\nabla\cdot{\bf u}^{n+1}=0`$ã¨ã—ã¦ãã‚Œã‚‹
$`\frac{D {\bf u}}{D t} =-\frac{1}{\rho} \nabla p^{n+1}+\nu \nabla^2 {\bf u}^n+{\bf g}`$ã‚’ä½¿ã£ã¦ï¼Œæµé€Ÿã¨ç²’å­ä½ç½®ã‚’æ™‚é–“ç™ºå±•ã•ã›ãŸã„ï¼
ãã®ãŸã‚ã«ã¯ï¼Œåœ§åŠ›$`p^{n+1}`$ã‚’é©åˆ‡ã«æ±ºã‚ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼

$`\frac{D {\bf u}}{D t}`$ã¯ï¼$`\frac{{\bf u}^{n+1} - {\bf u}^{n}}{\Delta t}`$ã¨é›¢æ•£åŒ–ã—æ¡ä»¶ã‚’è€ƒãˆã¦ã¿ã‚‹ï¼

```math
\frac{{\bf u}^{n+1} - {\bf u}^{n}}{\Delta t} =-\frac{1}{\rho} \nabla p^{n+1}+\nu \nabla^2 {\bf u}^n+{\bf g}
```

æ¬¡æ™‚åˆ»ã®ç™ºæ•£ã®æ¼”ç®—ã¯ï¼Œæ¬¡æ™‚åˆ»ã«ãŠã‘ã‚‹ç²’å­é…ç½®ã«åŸºã¥ãè¡Œã‚ã‚Œã‚‹ã®ã§ï¼Œç¾åœ¨ã®ç²’å­é…ç½®ã«åŸºã¥ãç™ºæ•£æ¼”ç®—ã¨ã¯åŒºåˆ¥ã™ã¹ãã§ã‚ã‚‹ï¼
ç¾åœ¨ã®å¾®åˆ†æ¼”ç®—ã‚’$`\nabla^{n}`$ã¨ã—ï¼Œæ¬¡æ™‚åˆ»ã®å¾®åˆ†æ¼”ç®—ã‚’$`\nabla^{n+1}`$ã¨ã™ã‚‹ï¼
$`\nabla^{n+1}`$ã‚’ä¸Šã®å¼ã«ä½œç”¨ã•ã›ã‚‹ã¨ï¼Œ

```math
\nabla^{n+1}\cdot {\bf u}^{n+1} = \nabla^{n+1} \cdot{\bf u}^{n} - \Delta t \nabla^{n+1} \cdot\left(\frac{1}{\rho} \nabla^{n} p^{n+1}-\nu \nabla^{n2} {\bf u}^n-{\bf g}\right)
```

å³è¾ºãŒã‚¼ãƒ­ã¨ãªã‚Œã°ï¼Œæ¬¡æ™‚åˆ»ã®æµé€Ÿã®ç™ºæ•£ãŒã‚¼ãƒ­ï¼Œ$`\nabla^{n+1}{\bf u}^{n+1}=0`$ã«ãªã‚‹ï¼š

```math
\begin{align*}
&&0 &= \nabla^{n+1} \cdot{\bf u}^{n} - \Delta t \nabla^{n+1} \cdot\left(\frac{1}{\rho} \nabla^{n} p^{n+1}-\nu \nabla^{n2} {\bf u}^n-{\bf g}\right)\\
&\rightarrow&\nabla^{n+1} \cdot \left(\frac{1}{\rho^n} \nabla^{n} p^{n+1}\right) &= \frac{1}{\Delta t}\nabla^{n+1} \cdot{\bf u}^{n} + \nabla^{n+1} \cdot\left(\nu^n \nabla^{n2} {\bf u}^n  + {\bf g}\right)\\
&\rightarrow& \nabla^{n+1} \cdot \left(\frac{1}{\rho^n} \nabla^{n} p^{n+1}\right) &= \nabla^{n+1} \cdot\left(\frac{1}{\Delta t}{\bf u}^{n} +\nu^n \nabla^{n2} {\bf u}^n  + {\bf g}\right)\\
&\rightarrow& \nabla^{n+1} \cdot \left(\frac{1}{\rho^n} \nabla^{n} p^{n+1}\right) &= b = \nabla^{n+1} \cdot {\bf b}^n,\quad  {\bf b}^n=\frac{1}{\Delta t}{\bf u}^{n} +\nu^n \nabla^{n2} {\bf u}^n
\end{align*}
```

é‡åŠ›ã®ç™ºæ•£ã¯ã‚¼ãƒ­ãªã®ã§æ¶ˆã—ãŸï¼

### ğŸª¸å³è¾ºï¼Œ$`b`$ï¼Œ`PoissonRHS`ã«ã¤ã„ã¦ 

ã“ã®$`b`$ã‚’`PoissonRHS`ã¨ã™ã‚‹ï¼ï¼ˆä»®æµé€Ÿã¯$`{\bf u}^\ast = \frac{\Delta t}{\rho}{\bf b}^n`$ã¨åŒã˜ï¼‰ï¼
$`{\bf b}^n`$ ï¼ˆ[`Poisson_b_vector`](../../builds/build_sph/SPH_Functions.hpp#L303)ï¼‰ãŒè¨ˆç®—ã§ãã‚‹ã‚ˆã†ã«ï¼Œ$`{\bf u}^n`$ã¨$`\nabla^2 {\bf u}^n`$ã‚’è¨ˆç®—ã—ã¦ãŠãï¼

âœ… [ç™ºæ•£ã®è¨ˆç®—æ–¹æ³•](../../builds/build_sph/SPH_FindPressure.hpp#L181): $`b=\nabla\cdot{\bf b}^n=\sum _{j}\frac{m _j}{\rho _j}({\bf b} _j^n-{\bf b} _i^n)\cdot\nabla W _{ij}`$

### ğŸª¸å·¦è¾ºã«ã¤ã„ã¦ 

å£ç²’å­ã®åœ§åŠ›ã¯æ™‚é–“ç©åˆ†ã—ã¦è¨ˆç®—ã—ãªã„ã®ã§ï¼Œæ¯æ™‚åˆ»ï¼Œå£ç²’å­ã®$`p^{n+1}`$ã‚’è¨ˆç®—ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ï¼

**EISPH**

1. å£ç²’å­ã®åœ§åŠ›ã®è¨ˆç®—ï¼ˆæµä½“ç²’å­ã®ç¾åœ¨ã®åœ§åŠ›$`p^n`$ã ã‘ã‚’ä½¿ã£ã¦è¿‘ä¼¼ï¼‰
2. æµä½“ç²’å­ã®åœ§åŠ›$`p^{n+1}`$ã®è¨ˆç®—

**ISPH**

- ISPHã¯ä½œã£ãŸãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼ã‚’ä½œæˆã—è§£ãã“ã¨ã§åœ§åŠ›ã‚’è¨ˆç®—ã™ã‚‹

âœ… [ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³ã®è¨ˆç®—æ–¹æ³•](../../builds/build_sph/SPH_FindPressure.hpp#L188): $`\nabla^2 p^{n+1}=\sum _{j}A _{ij}(p _i^{n+1} - p _j^{n+1}),\quad A _{ij} = \frac{2m _j}{\rho _i}\frac{{{\bf x} _{ij}}\cdot\nabla W _{ij}}{{\bf x} _{ij}^2}`$

### ğŸª¸æ°´é¢ã®è¨ˆç®—è£œåŠ©ç²’å­`auxiliaryPoints` 

æ°´é¢ã«ãŠã„ã¦ã¯ï¼Œæµé€Ÿã®ç™ºæ•£ã‚¼ãƒ­$`\nabla^{n+1} {\bf u}^{n+1}=0`$ã¨$`p^{n+1}=0`$ãŒæº€ãŸã•ã‚Œã‚‹å¿…è¦ãŒã‚ã‚‹ï¼
æ°´é¢å¤–éƒ¨ã«ã¯ï¼Œç²’å­ãŒãªã„ã®ã§ï¼Œæ±‚ã‚ãŸæ°´é¢åœ§åŠ›ã¯ï¼Œã‚¼ãƒ­ã§ã‚ã£ã¦ã‚‚ï¼Œåœ§åŠ›å‹¾é…ã¯èª¤å·®ã‚’å«ã¿ï¼Œ$`\nabla^{n+1} {\bf u}^{n+1}=0`$ã¯æº€è¶³ã•ã‚Œãªã„ï¼
ãã“ã§ï¼Œ[æ°´é¢ã®è¨ˆç®—è£œåŠ©ç²’å­](../../include/Network.hpp#L491)ã‚’æ°´é¢å¤–éƒ¨ã«è¿½åŠ ã—ï¼Œã“ã®ç‚¹ã‚’é©åˆ‡è¨ˆç®—ã™ã‚‹ã“ã¨ã§ï¼Œ$`\nabla^{n+1} {\bf u}^{n+1}=0`$ãŒæº€è¶³ã•ã‚Œã‚‹ã‚ˆã†ã«å·¥å¤«ã™ã‚‹ï¼


[./SPH_FindPressure.hpp#L7](./SPH_FindPressure.hpp#L7)


### ğŸª¸æ¬¡æ™‚åˆ»ã®ç™ºæ•£æ¼”ç®—ï¼Œ$`\nabla^{n+1} \cdot {\bf b}^n = \sum _j \dfrac{m _j}{\rho _j^{n+1}}({\bf b} _j^n-{\bf b} _i^n)\cdot \nabla W({\bf x} _i^{n+1},{\bf x} _j^{n+1},h)`$ 

$`\nabla^{n+1}`$ã®è¨ˆç®—ã«ã¯ï¼Œ$`\rho^{n+1}`$, $`{\bf x}^{n+1}= {\bf x}^{n} + {\bf u}^{n+1} \Delta t`$ãŒå¿…è¦ã§ã‚ã‚‹ï¼

* [æ¬¡æ™‚åˆ»ã®ç²’å­ä½“ç©](../../builds/build_sph/SPH_Functions.hpp#L189)
* [æ¬¡æ™‚åˆ»ã®ç²’å­å¯†åº¦](../../builds/build_sph/SPH_Functions.hpp#L182)
* [æ¬¡æ™‚åˆ»ã®ç²’å­ä½ç½®](../../builds/build_sph/SPH_Functions.hpp#L194)


[./SPH_FindPressure.hpp#L74](./SPH_FindPressure.hpp#L74)


### ğŸª¸ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼ã®ä½œæˆã®ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° 

å„ç²’å­`ROW`ã«å¯¾ã—ã¦ï¼Œæ–¹ç¨‹å¼ã‚’ä½œæˆã™ã‚‹ï¼

ã¾ãšã¯ï¼Œ[æ–¹ç¨‹å¼ã‚’ç«‹ã¦ã‚‹ä½ç½®ã‚’æ±ºã‚ã‚‹ï¼](../../builds/build_sph/SPH_FindPressure.hpp#L227)


[./SPH_FindPressure.hpp#L115](./SPH_FindPressure.hpp#L115)


å„ç²’å­`ROW`ãŒï¼Œæµä½“ã‹å£ã‹è£œåŠ©ç²’å­ã‹æ°´é¢ã‹ã«ã‚ˆã£ã¦ï¼Œæ–¹ç¨‹å¼ãŒç•°ãªã‚‹ï¼

|æ–¹ç¨‹å¼|ç›®çš„|
|:---------|---|
| â˜‘ï¸ [ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼](../../builds/build_sph/SPH_FindPressure.hpp#L176)              | æ¬¡æ™‚åˆ»ã®æµé€Ÿã®ç™ºæ•£ã‚’ã‚¼ãƒ­ã«ã™ã‚‹ï¼ˆéåœ§ç¸®æ€§ã‚’æº€ãŸã™ï¼‰ã‚ˆã†ã«åœ§åŠ›ã‚’æ±ºå®šã™ã‚‹ï¼ |
| â˜ [ä¸é€éæ¡ä»¶](../../builds/build_sph/SPH_FindPressure.hpp#L141)         | ã“ã®å¼ã¯åœ§åŠ›å‹¾é…ãŒãã‚Œä»¥å¤–ã®åŠ›ã‚’æ‰“ã¡æ¶ˆã™ã‚ˆã†ã«åœ§åŠ›ã‚’æ±ºå®šã™ã‚‹ï¼å£é¢ä»˜è¿‘ã®åœ§åŠ›ãŒæ»‘ã‚‰ã‹ã«ãªã‚‰ãªã„ãŸã‚ä½¿ã‚ãªã„ï¼ |
| â˜ [å¤§æ°—åœ§æ¡ä»¶](../../builds/build_sph/SPH_FindPressure.hpp#L164) | ã“ã®å¼ã¯æ°´é¢ç²’å­ã®åœ§åŠ›ã‚’ã‚¼ãƒ­ã«å›ºå®šã™ã‚‹ï¼åœ§åŠ›ãŒã‚¼ãƒ­ã§ã‚ã‚‹ã¹ãå ´æ‰€ã¯æ°´é¢ã‹ã‚‰$h/2$ä¸Šãªã®ã§ä½¿ã‚ãªã„ï¼ |

å„æ–¹ç¨‹å¼ã¯ï¼Œ`equation(åˆ—ç•ªå·ã‚’æŒ‡å®šã™ã‚‹ç²’å­ãƒã‚¤ãƒ³ã‚¿, è¨ˆç®—ã«ä½¿ã‚ã‚Œã‚‹ç‰©æ€§å€¤ã‚’æŒã¤ç²’å­ãƒã‚¤ãƒ³ã‚¿, æ–¹ç¨‹å¼ã‚’ç«‹ã¦ã‚‹ä½ç½®)`ã®å½¢ã§ä½¿ç”¨ã™ã‚‹ï¼


[./SPH_FindPressure.hpp#L127](./SPH_FindPressure.hpp#L127)


### ğŸª¸ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼ã®ä½œæˆ


[./SPH_FindPressure.hpp#L221](./SPH_FindPressure.hpp#L221)


## â›µï¸ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼ã®è§£æ³• 

ISPHã®ãƒã‚¢ã‚½ãƒ³æ–¹ç¨‹å¼ã‚’è§£ãå ´åˆï¼Œ[ã“ã“ã§ã¯GMRESæ³•](../../builds/build_sph/SPH_FindPressure.hpp#L380)ã‚’ä½¿ã†ï¼


[./SPH_FindPressure.hpp#L312](./SPH_FindPressure.hpp#L312)


### ğŸª¸CFLæ¡ä»¶ã®è¨­å®š 

$`\max({\bf u}) \Delta t \leq c _{v} h \cap \max({\bf a}) \Delta t^2 \leq c _{a} h`$
ã‚’æº€ãŸã™ã‚ˆã†ã«ï¼Œæ¯æ™‚åˆ»$`\Delta t`$ã‚’è¨­å®šã™ã‚‹ï¼


[./SPH_Functions.hpp#L72](./SPH_Functions.hpp#L72)


## â›µï¸$`\nabla^2 {\bf u} _i`$ã®è¨ˆç®— 

âœ… [ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³ã®è¨ˆç®—æ–¹æ³•](../../builds/build_sph/SPH_Functions.hpp#L250): $`\nabla^2 {\bf u} _i=\sum _{j} A _{ij}({\bf u} _i - {\bf u} _j),\quad A _{ij} = \frac{2m _j}{\rho _i}\frac{{{\bf x} _{ij}}\cdot\nabla W _{ij}}{{\bf x} _{ij}^2}`$


[./SPH_Functions.hpp#L206](./SPH_Functions.hpp#L206)


### ğŸª¸é«˜é€ŸåŒ–ã®ãŸã‚ã®å·¥å¤« 

ä½•åº¦ã‹è¡Œã†å‹¾é…ã®è¨ˆç®—ã¯ï¼Œå¤‰æ•°ã¯é•ãˆã©ï¼Œå¤‰æ•°ã®ä¿‚æ•°ã¯åŒã˜ã§ã‚ã‚‹ï¼
ã“ã“ã§ï¼Œãã®ä¿‚æ•°ã‚’`std::unordered_map`ã§ä¿å­˜ã—ã¦ãŠãã“ã¨ã«ã™ã‚‹ï¼
`A->grad_coeff`ã¨`A->grad_coeff_next`ã«ä¿å­˜ã™ã‚‹ï¼

ğŸ’¡ `A->grad_coeff`ã¨`A->grad_coeff_next`ã¯ï¼Œè‡ªèº«ã‚‚ã‚­ãƒ¼ã¨ã—ã¦å«ã‚€ï¼ä½¿ã†æ™‚ã«æ³¨æ„ã™ã‚‹ï¼


[./SPH_Functions.hpp#L232](./SPH_Functions.hpp#L232)


## â›µï¸åœ§åŠ›å‹¾é…$`\nabla p^{n+1}`$ã®è¨ˆç®— 

âœ… [å‹¾é…ã®è¨ˆç®—æ–¹æ³•](../../builds/build_sph/SPH_setWall_Freesurface.hpp#L150): $`\nabla p _i = \rho _i \sum _{j} m _j (\frac{p _i}{\rho _i^2} + \frac{p _j}{\rho _j^2}) \nabla W _{ij}`$

âœ… [å‹¾é…ã®è¨ˆç®—æ–¹æ³•](../../builds/build_sph/SPH_setWall_Freesurface.hpp#L151): $`\nabla p _i = \rho _i \sum _{j} m _j \left(p _j - p _i\right) \nabla W _{ij}`$

âœ… [å‹¾é…ã®è¨ˆç®—æ–¹æ³•](../../builds/build_sph/SPH_Functions.hpp#L396): $`\nabla p _i = \sum _{j} \frac{m _j}{\rho _j} p _j \nabla W _{ij}`$


[./SPH_Functions.hpp#L357](./SPH_Functions.hpp#L357)


$`\dfrac{D{\bf u}^n}{Dt} = - \frac{1}{\rho} \nabla p^{n+1} + \nu \nabla^2 {\bf u}^n + {\bf g}`$
ãŒè¨ˆç®—ã§ããŸï¼


[./SPH_Functions.hpp#L417](./SPH_Functions.hpp#L417)


## â›µï¸æ³¨æ„ç‚¹ 

âš ï¸ è¨ˆç®—ãŒã†ã¾ãè¡Œãè¨­å®šã‚’çŸ¥ã‚‹ãŸã‚ã«ï¼Œæ¬¡ã®ç®‡æ‰€ã‚’ãƒã‚§ãƒƒã‚¯ã™ã‚‹ï¼

**å£ç²’å­**

- [å£ç²’å­ã®ãƒ©ãƒ—ãƒ©ã‚·ã‚¢ãƒ³ã®è¨ˆç®—æ–¹æ³•](../../builds/build_sph/SPH_Functions.hpp#L284)
- [åœ§åŠ›ã®è¨ˆç®—æ–¹æ³•](../../builds/build_sph/SPH_FindPressure.hpp#L86)
- [ã©ã®ä½ç½®ã«ãŠã„ã¦æ–¹ç¨‹å¼ã‚’ç«‹ã¦ã‚‹ã‹](../../builds/build_sph/SPH_FindPressure.hpp#L227)
- [æµä½“ã¨ã—ã¦æ‰±ã†å£ç²’å­ã‚’è¨­å®šã™ã‚‹ã‹ã©ã†ã‹](../../builds/build_sph/SPH_setWall_Freesurface.hpp#L79)/[è¦–é‡è§’ã«æµä½“ç²’å­ãŒå«ã¾ãªã„å£ç²’å­ã¯é™¤å¤–ã™ã‚‹](not found)
- [å£ç²’å­ã®åœ§åŠ›ã‚’ã©ã®ã‚ˆã†ã«å£é¢ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã™ã‚‹ã‹](not found)
- [å£ç²’å­ã®æ³•ç·šæ–¹å‘ãƒ™ã‚¯ãƒˆãƒ«ã®è¨ˆç®—æ–¹æ³•](../../builds/build_sph/SPH_setWall_Freesurface.hpp#L243)
- [åå°„ã®è¨ˆç®—æ–¹æ³•](../../builds/build_sph/SPH_Functions.hpp#L473)

**æ°´é¢ç²’å­**

- [æ°´é¢ç²’å­ã®åœ§åŠ›ã‚’ã‚¼ãƒ­ã«ã™ã‚‹ã‹ã©ã†ã‹](not found)
- [è£œåŠ©ç²’å­ã®è¨­å®šã¯ã©ã†ãªã£ã¦ã„ã‚‹ã‹](../../include/Network.hpp#L491)

**ãã®ä»–**

- [å¯†åº¦ã‚’æ›´æ–°ã™ã‚‹ã‹ã©ã†ã‹](../../builds/build_sph/SPH_Functions.hpp#L530)
- [åœ§åŠ›ã®å®‰å®šåŒ–ã‚’ã™ã‚‹ã‹ã©ã†ã‹](../../builds/build_sph/SPH_FindPressure.hpp#L182)
- [ãƒ«ãƒ³ã‚²ã‚¯ãƒƒã‚¿ã®æ®µæ•°](../../builds/build_sph/input_generator_old.py#L143)


å£ã®wall_as_fluidã¯ç¹°ã‚Šè¿”ã—ã§è¨ˆç®—ã™ã‚‹ã®ã¯ã©ã†ã‹ï¼Ÿ


[./SPH_Functions.hpp#L546](./SPH_Functions.hpp#L546)


## â›µï¸å£é¢ç²’å­ã®æµé€Ÿã¨åœ§åŠ› 

å£ç²’å­ã®æµé€Ÿã‚’æµä½“ç²’å­ã®æµé€Ÿã«å¿œã˜ã¦å¤‰åŒ–ã•ã›ã‚‹ã¨ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒç…©é›‘ã«ãªã‚‹ã®ã§ï¼Œ**ã“ã“ã§ã¯**å£é¢ç²’å­ã®æµé€Ÿã¯å¸¸ã«ã‚¼ãƒ­ã«è¨­å®šã™ã‚‹ã“ã¨ã«ã™ã‚‹ï¼
å£ç²’å­ã®åœ§åŠ›ã¯ï¼Œæ°´ãŒåœ§ç¸®ã—ãªã„ã‚ˆã†ã«å„ã‚¹ãƒ†ãƒƒãƒ—æ¯ã«è¨ˆç®—ã—ç›´ã™å¿…è¦ãŒã‚ã‚‹ï¼


[./SPH_setWall_Freesurface.hpp#L39](./SPH_setWall_Freesurface.hpp#L39)


## â›µï¸æ³•ç·šæ–¹å‘ã®è¨ˆç®—ã¨æ°´é¢ã®åˆ¤å®š


[./SPH_setWall_Freesurface.hpp#L171](./SPH_setWall_Freesurface.hpp#L171)


### ğŸª¸æ³•ç·šæ–¹å‘ã®è¨ˆç®— 

âœ… [å˜ä½æ³•ç·šãƒ™ã‚¯ãƒˆãƒ«](../../builds/build_sph/SPH_setWall_Freesurface.hpp#L243): $`{\bf n} _i = {\rm Normalize}\left(-\sum _j {\frac{m _j}{\rho _j} \nabla W _{ij} }\right)`$

å˜ä½æ³•ç·šãƒ™ã‚¯ãƒˆãƒ«ã¯ï¼Œ`interpolated_normal_SPH`ã¨ã—ã¦ã„ã‚‹ï¼


[./SPH_setWall_Freesurface.hpp#L185](./SPH_setWall_Freesurface.hpp#L185)


### ğŸª¸æ°´é¢ã®åˆ¤å®š 

`surface_condition0,1`ã®ä¸¡æ–¹ã‚’æº€ãŸã™å ´åˆï¼Œæ°´é¢ã¨ã™ã‚‹ï¼


[./SPH_setWall_Freesurface.hpp#L265](./SPH_setWall_Freesurface.hpp#L265)


## â›µï¸æ°´é¢è£œåŠ©ç²’å­ã®ä½œæˆ


[./SPH_setWall_Freesurface.hpp#L293](./SPH_setWall_Freesurface.hpp#L293)


# ğŸ‹å®Ÿè¡Œæ–¹æ³• 

ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¦ï¼Œ`build_sph`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ç§»å‹•ï¼

```
$ git clone https://github.com/tomoakihirakawa/cpp.git
$ cd ./cpp/builds/build_sph
```

`clean`ã§CMakeé–¢é€£ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤ã—ã¦ï¼ˆã‚´ãƒŸãŒã‚ã‚‹ã‹ã‚‚ã—ã‚Œãªã„ã®ã§ï¼‰ï¼Œ
`cmake`ã§`Makefile`ã‚’ç”Ÿæˆã—ã¦ï¼Œ`make`ã§ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã™ã‚‹ï¼

```
$ sh clean
$ cmake -DCMAKE_BUILD_TYPE=Release ../
$ make
```

æ¬¡ã«ï¼Œå…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç”Ÿæˆï¼

```
$ python3 input_generator.py
```

ä¾‹ãˆã°ï¼Œ`./input_files/static_pressure_PS0d0125_CSML2d4_RK1`ãŒç”Ÿæˆã•ã‚Œã‚‹ï¼
å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æŒ‡å®šã—ã¦å®Ÿè¡Œï¼

```
$ ./main ./input_files/static_pressure_PS0d0125_CSML2d4_RK1
```


[./main.cpp#L1](./main.cpp#L1)


# ğŸ‹ãƒ†ã‚¹ãƒˆ 

## â›µï¸æ ¸é–¢æ•°ã®ãƒ†ã‚¹ãƒˆ 

## â›µï¸â›µï¸5æ¬¡ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³é–¢æ•°  

ï¼“æ¬¡å…ƒã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ç”¨ã„ã‚‰ã‚Œã‚‹ï¼Œ5æ¬¡ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³é–¢æ•°ï¼š

```math
W _{5}(q,h) = \frac{2187}{40\pi h^3}
\begin{cases}
(1-q)^5 - 6(\frac{2}{3}-q)^5 + 15(\frac{1}{3}-q)^5 & (0 \leq q < \frac{1}{3}) \\
(1-q)^5 - 6(\frac{2}{3}-q)^5 & (\frac{1}{3} \leq q < \frac{2}{3}) \\
(1-q)^5 & (\frac{2}{3} \leq q < 1) \\
0 & (q \geq 1)
\end{cases}
```

ãã®å‹¾é…ã¯ï¼Œ

```math
\nabla W _{5}(q,h) = \frac{2187}{40\pi h^4}
\begin{cases}
-5(1-q)^4 + 30(\frac{2}{3}-q)^4 - 75(\frac{1}{3}-q)^4 & (0 \leq q < \frac{1}{3}) \\
-5(1-q)^4 + 30(\frac{2}{3}-q)^4 & (\frac{1}{3} \leq q < \frac{2}{3}) \\
-5(1-q)^4 & (\frac{2}{3} \leq q < 1) \\
0 & (q \geq 1)
\end{cases}
```

ãƒ˜ãƒƒã‚·ã‚¢ãƒ³ã¯ï¼Œ

```math
\nabla^2 W _{5}(q,h) = \frac{2187}{40\pi h^5}
\begin{cases}
20(1-q)^3 - 120(\frac{2}{3}-q)^3 + 300(\frac{1}{3}-q)^3 & (0 \leq q < \frac{1}{3}) \\
20(1-q)^3 - 120(\frac{2}{3}-q)^3 & (\frac{1}{3} \leq q < \frac{2}{3}) \\
20(1-q)^3 & (\frac{2}{3} \leq q < 1) \\
0 & (q \geq 1)
\end{cases}
```

[../../include/kernelFunctions.hpp#L74](../../include/kernelFunctions.hpp#L74)

## â›µï¸â›µï¸3æ¬¡ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³é–¢æ•°  

ï¼“æ¬¡å…ƒã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ã§ç”¨ã„ã‚‰ã‚Œã‚‹ï¼Œ3æ¬¡ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³é–¢æ•°ï¼š

```math
W _{3}(q,h) = \frac{8}{\pi h^3}
\begin{cases}
(1-6q^2+6q^3) & (0 \leq q < \frac{1}{2}) \\
2(1-q)^3 & (\frac{1}{2} \leq q < 1) \\
0 & (q \geq 1)
\end{cases}
```

ãã®å‹¾é…ã¯ï¼Œ

```math
\nabla W _{3}(q,h) =
-{\nabla q}\frac{48}{\pi h^4}
\begin{cases}
-2q+3q^2 & (0 \leq q < \frac{1}{2}) \\
(1-q)^2 & (\frac{1}{2} \leq q < 1) \\
0 & (q \geq 1)
\end{cases}
,\quad
\nabla q = \frac{\nabla r}{h} = \frac{{\bf x} _i - {\bf x} _j}{r h}
```

ãƒ˜ãƒƒã‚·ã‚¢ãƒ³ã¯ï¼Œ

```math
\nabla\otimes\nabla W _{3}(q,h) =
-\frac{48}{\pi h^4}
\begin{cases}
-2\nabla \otimes{(q\nabla q)}+3\nabla \otimes{(q^2\nabla q)} & (0 \leq q < \frac{1}{2}) \\
\nabla \otimes ((1-q)^2\nabla q) & (\frac{1}{2} \leq q < 1) \\
0 & (q \geq 1)
\end{cases}
,\quad
\nabla q = \frac{\nabla r}{h} = \frac{{\bf x} _i - {\bf x} _j}{r h}\\
= -\frac{48}{\pi h^4}
\begin{cases}
-2\nabla \otimes{(\frac{r}{h}\frac{{\bf x} _i - {\bf x} _j}{r})}+3\nabla \otimes{(\frac{r^2}{h^2}\frac{{\bf x} _i - {\bf x} _j}{r})} & (0 \leq q < \frac{1}{2}) \\
\nabla \otimes{(\frac{r^2}{h^2}\frac{{\bf x} _i - {\bf x} _j}{r})} & (\frac{1}{2} \leq q < 1) \\
0 & (q \geq 1)
\end{cases}
```

[../../include/kernelFunctions.hpp#L167](../../include/kernelFunctions.hpp#L167)



ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã—ãŸ[3æ¬¡ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³é–¢æ•°](../../include/kernelFunctions.hpp#L166)ã¨[5æ¬¡ã‚¹ãƒ—ãƒ©ã‚¤ãƒ³é–¢æ•°](../../include/kernelFunctions.hpp#L73)ã®ãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰

* é–¢æ•°ã®å½¢çŠ¶ã‚’ç¢ºèªï¼
* ä½“ç©ç©åˆ†ãŒ1ã«ãªã‚‹ã‹ã©ã†ã‹ã‚’ç¢ºèªï¼

| åˆ†å‰²æ•°$N$ï¼Œä½“ç©$`V=(\frac{2r}{N})^3`$   | Sum for 3rd Order | Sum for 5th Order |
| --- | ----------------- | ----------------- |
| 5   | 1.00527           | 0.999206          |
| 10  | 1.00011           | 1.00005           |
| 15  | 0.999972          | 0.999999          |
| 20  | 1                 | 1                 |
| 25  | 1                 | 1                 |


[./test_KernelFunctions.cpp#L1](./test_KernelFunctions.cpp#L1)


---
## â›µï¸Bucketã‚’ç”¨ã„ãŸç²’å­æ¢ç´¢ã®ãƒ†ã‚¹ãƒˆ 

Smoothed Particle Hydrodynamics (SPH)ã§ã¯ï¼ŒåŠ¹ç‡çš„ãªè¿‘å‚ç²’å­æ¢æŸ»ãŒå¿…è¦ã¨ãªã‚‹ï¼
ã“ã®ã‚³ãƒ¼ãƒ‰ã§ã¯ï¼ŒBucketã‚’ç”¨ã„ãŸç²’å­æ¢ç´¢ã®ãƒ†ã‚¹ãƒˆã‚’è¡Œã†ï¼

çµæœã¯VTKãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›ã•ã‚Œã‚‹ï¼
* å…¨ã¦ã®ç²’å­ã‚’è¡¨ç¤ºã—ãŸã‚‚ã®ã¯`all.vtp`
* ä¸­å¿ƒã®ç²’å­ã‚’è¡¨ç¤ºã—ãŸã‚‚ã®ã¯`center*.vtp`
* ä¸­å¿ƒã®ç²’å­ãŒæ¢æŸ»ã—ãŸã‚»ãƒ«å†…ã«ã‚ã‚‹ç²’å­ã‚’è¡¨ç¤ºã—ãŸã‚‚ã®ã¯`inCell*.vtp`
* ã‚»ãƒ«å†…ã‹ã¤çƒå†…ã«ã‚ã‚‹ç²’å­ã‚’è¡¨ç¤ºã—ãŸã‚‚ã®ã¯`inSphere*.vtp`

- å„ã‚»ãƒ«ã«ã‚ã‚‹ç²’å­ã‚’è¡¨ç¤ºã—ãŸã‚‚ã®ã¯`each_cell*.vtp`
- å„ã‚»ãƒ«ã®ä¸­å¿ƒä½ç½®ã‚’è¡¨ç¤ºã—ãŸã‚‚ã®ã¯`each_cell_position*.vtp`


[./test_Buckets.cpp#L1](./test_Buckets.cpp#L1)


---
