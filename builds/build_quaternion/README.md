# Contents

- [ğŸ‹ ã‚¯ã‚©ãƒ¼ã‚¿ãƒ‹ã‚ªãƒ³ã‚’ä½¿ã£ãŸç‰©ä½“ã®ï¼“æ¬¡å…ƒå›è»¢](#ğŸ‹-ã‚¯ã‚©ãƒ¼ã‚¿ãƒ‹ã‚ªãƒ³ã‚’ä½¿ã£ãŸç‰©ä½“ã®ï¼“æ¬¡å…ƒå›è»¢)
    - [â›µ ã‚¯ã‚©ãƒ¼ã‚¿ãƒ‹ã‚ªãƒ³ã‚’ä½¿ã£ãŸã‚·ãƒ³ãƒ—ãƒ«ãªå›è»¢](#â›µ-ã‚¯ã‚©ãƒ¼ã‚¿ãƒ‹ã‚ªãƒ³ã‚’ä½¿ã£ãŸã‚·ãƒ³ãƒ—ãƒ«ãªå›è»¢)
    - [â›µ ã‚¯ã‚©ãƒ¼ã‚¿ãƒ‹ã‚ªãƒ³ã®æ™‚é–“å¾®åˆ†ï¼Œè§’é€Ÿåº¦](#â›µ-ã‚¯ã‚©ãƒ¼ã‚¿ãƒ‹ã‚ªãƒ³ã®æ™‚é–“å¾®åˆ†ï¼Œè§’é€Ÿåº¦)
    - [â›µ â›µ ã‚¯ã‚©ãƒ¼ã‚¿ãƒ‹ã‚ªãƒ³ã®å¾®åˆ†](#â›µ-â›µ-ã‚¯ã‚©ãƒ¼ã‚¿ãƒ‹ã‚ªãƒ³ã®å¾®åˆ†)
    - [â›µ â›µ è§’åŠ é€Ÿåº¦ã‹ã‚‰ã‚¯ã‚©ãƒ¼ã‚¿ãƒ‹ã‚ªãƒ³ã®å¾®åˆ†ã‚’è¨ˆç®—](#â›µ-â›µ-è§’åŠ é€Ÿåº¦ã‹ã‚‰ã‚¯ã‚©ãƒ¼ã‚¿ãƒ‹ã‚ªãƒ³ã®å¾®åˆ†ã‚’è¨ˆç®—)


---
# ğŸ‹ ã‚¯ã‚©ãƒ¼ã‚¿ãƒ‹ã‚ªãƒ³ã‚’ä½¿ã£ãŸç‰©ä½“ã®ï¼“æ¬¡å…ƒå›è»¢ 

## â›µ ã‚¯ã‚©ãƒ¼ã‚¿ãƒ‹ã‚ªãƒ³ã‚’ä½¿ã£ãŸã‚·ãƒ³ãƒ—ãƒ«ãªå›è»¢ 

ã‚¯ã‚©ãƒ¼ã‚¿ãƒ‹ã‚ªãƒ³ã¯ï¼Œ3Då›è»¢ã‚’åŠ¹ç‡çš„ã«è¨ˆç®—ã™ã‚‹ãŸã‚ã«ä¾¿åˆ©ãªè¡¨ç¾ï¼

ã‚ã‚‹å›è»¢è»¸$v$ã«å¯¾ã—ã¦ï¼Œè§’åº¦$\theta$ã ã‘å›è»¢ã™ã‚‹ã‚¯ã‚©ãƒ¼ã‚¿ãƒ‹ã‚ªãƒ³$q$ã¯ä»¥ä¸‹ã®ã‚ˆã†ã«è¡¨ã•ã‚Œã‚‹ï¼

```math
\begin{aligned}
q &= a + bi + cj + dk = \cos(\theta/2) +  \sin(\theta/2) \cdot \dfrac{v _x i + v _y k + v _z k}{\|v\|}\\
v &= (v _x, v _y, v _z)
\end{aligned}
```

`Rv()` a rotation transformation in the global coordinate system.

```math
Rv = \begin{bmatrix}
a^2 + b^2 - c^2 - d^2 & 2 \cdot b \cdot c - 2 \cdot a \cdot d & 2 \cdot a \cdot c + 2 \cdot b \cdot d \\
2 \cdot b \cdot c + 2 \cdot a \cdot d & a^2 - b^2 + c^2 - d^2 & -2 \cdot a \cdot b + 2 \cdot c \cdot d \\
-2 \cdot a \cdot c + 2 \cdot b \cdot d & 2 \cdot a \cdot b + 2 \cdot c \cdot d & a^2 - b^2 - c^2 + d^2 \\
\end{bmatrix}
```

The `Rs()` function looks like it's used to calculate how the global coordinates move relative to the object's coordinates, through rotation.
The matrix representation is:

```math
Rs = \begin{bmatrix}
a^2 + b^2 - c^2 - d^2 & 2 \cdot b \cdot c + 2 \cdot a \cdot d & -2 \cdot a \cdot c + 2 \cdot b \cdot d \\
2 \cdot b \cdot c - 2 \cdot a \cdot d & a^2 - b^2 + c^2 - d^2 & 2 \cdot a \cdot b + 2 \cdot c \cdot d \\
2 \cdot a \cdot c + 2 \cdot b \cdot d & -2 \cdot a \cdot b + 2 \cdot c \cdot d & a^2 - b^2 - c^2 + d^2 \\
\end{bmatrix}
```

[../../include/basic_vectors.hpp#L1345](../../include/basic_vectors.hpp#L1345)



* ä»¥ä¸‹ã®ã‚³ãƒ¼ãƒ‰ã¯ã€3Dã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®å›è»¢ã¨å¹³è¡Œç§»å‹•ã‚’å®Ÿè¡Œã—ã¾ã™ï¼
* translateé–¢æ•°ï¼šãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®å…¨ç‚¹ã‚’æŒ‡å®šã—ãŸé‡ã ã‘å¹³è¡Œç§»å‹•ã—ã¾ã™ï¼
* rotateé–¢æ•°ï¼šæŒ‡å®šã—ãŸã‚¯ã‚©ãƒ¼ã‚¿ãƒ‹ã‚ªãƒ³ã¨ä¸­å¿ƒç‚¹ã‚’ä½¿ç”¨ã—ã¦ã€ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã®å…¨ç‚¹ã‚’å›è»¢ã—ã¾ã™ï¼
* mainé–¢æ•°ï¼šbunnyã€cowã€camelã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ãƒ­ãƒ¼ãƒ‰ã—ã¦ã€ãã‚Œãã‚Œã‚’å›è»¢ã•ã›ã€çµæœã‚’ãƒ•ã‚¡ã‚¤ãƒ«ã«å‡ºåŠ›ã—ã¾ã™ï¼

![sample.gif](sample.gif)

$x$è»¸ã«å¯¾ã—ã¦å›è»¢ -> $y$è»¸ã«å¯¾ã—ã¦å›è»¢ -> $z$è»¸ã«å¯¾ã—ã¦å›è»¢

$(0.1,0,0)$ã‚’ä¸­å¿ƒã«ã—ã¦$x$è»¸ã«å¯¾ã—ã¦å›è»¢ -> $y$è»¸ã«å¯¾ã—ã¦å›è»¢ -> $z$è»¸ã«å¯¾ã—ã¦å›è»¢

æ™‚è¨ˆå›ã‚ŠãŒæ­£ã§ã‚ã‚‹ï¼


[./validateRotation.cpp#L5](./validateRotation.cpp#L5)


---
## â›µ ã‚¯ã‚©ãƒ¼ã‚¿ãƒ‹ã‚ªãƒ³ã®æ™‚é–“å¾®åˆ†ï¼Œè§’é€Ÿåº¦ 

## â›µ â›µ ã‚¯ã‚©ãƒ¼ã‚¿ãƒ‹ã‚ªãƒ³ã®å¾®åˆ†  

ã‚¯ã‚©ãƒ¼ã‚¿ãƒ‹ã‚ªãƒ³ã¯å§¿å‹¢ã‚’è¡¨ã—ï¼Œã‚¯ã‚©ãƒ¼ã‚¿ãƒ‹ã‚ªãƒ³ã‚’ã‹ã‘ã‚‹ã“ã¨ã§å§¿å‹¢ã‚’å¤‰åŒ–ã•ã›ã‚‹ã“ã¨ãŒã§ãã‚‹ï¼

ä¸Šã®operator*ã«å®šç¾©ã•ã‚Œã‚‹ã‚ˆã†ã«
ã‚¯ã‚©ãƒ¼ã‚¿ãƒ‹ã‚ªãƒ³åŒå£«ã®ç©$`{\boldsymbol q} _1 * {\boldsymbol q} _2`$ã¯æ¬¡ã®ã‚ˆã†ã«è¨ˆç®—ã•ã‚Œã‚‹ï¼

```math
\begin{aligned}
{\boldsymbol q} _1 * {\boldsymbol q} _2 =
\begin{bmatrix}
a1 * a2 + -b1 * b2 + -c1 * c2 + -d1 * d2\\
a1 * b2 + b1 * a2 + c1 * d2 - d1 * c2\\
a1 * c2 - b1 * d2 + c1 * a2 + d1 * b2\\
a1 * d2 + b1 * c2 - c1 * b2 + d1 * a2
\end{bmatrix}
\end{aligned}
```

## â›µ â›µ è§’åŠ é€Ÿåº¦ã‹ã‚‰ã‚¯ã‚©ãƒ¼ã‚¿ãƒ‹ã‚ªãƒ³ã®å¾®åˆ†ã‚’è¨ˆç®—  

åˆæœŸå€¤å•é¡Œã‚’è§£ããŸã‚ã®æ•°å€¤è¨ˆç®—ã¯ï¼Œ$`x _{\text next} = x + \frac{dx}{dt} dt`$
ã¨ã„ã†å½¢ã«å¯¾ã—ã¦è€ƒãˆã‚‰ã‚Œã¦ã„ã‚‹ãŸã‚ï¼Œã“ã‚Œã«åˆã‚ã›ã‚‹ãŸã‚ã«ï¼Œã‚¯ã‚©ãƒ¼ã‚¿ãƒ‹ã‚ªãƒ³ã®å¾®åˆ†ã‚’è€ƒãˆã‚‹å¿…è¦ãŒã‚ã‚‹ï¼

æ¬¡ã®è¨ˆç®—ã®$`\lim _{dt \to 0}`$ã‚’å–ã‚‹ã¨ï¼Œè§’åŠ é€Ÿåº¦ã‹ã‚‰ã‚¯ã‚©ãƒ¼ã‚¿ãƒ‹ã‚ªãƒ³ã®å¾®åˆ†ã‚’è¨ˆç®—ã§ãã‚‹ï¼

```cpp
auto nextQ = Quaternion({1., 0., 0.}, w[0] * dt) * Quaternion({0., 1., 0.}, w[1] * dt) * Quaternion({0., 0., 1.}, w[2] * dt);
return ((nextQ * q)() - q()) / dt;
```

çµæœã¨ã—ã¦ä»¥ä¸‹ãŒå¾—ã‚‰ã‚Œã‚‹ï¼

```math
\begin{aligned}
\begin{bmatrix}
q0\\
q1\\
q2\\
q3
\end{bmatrix}
=
\begin{bmatrix}
-q1 * w0 - q2 * w1 - q3 * w2\\
q0 * w0 + q3 * w1 - q2 * w2\\
-q3 * w0 + q0 * w1 + q1 * w2\\
q2 * w0 - q1 * w1 + q0 * w2
\end{bmatrix}
\end{aligned}
```

ã“ã‚Œã‚’ä½¿ãˆã°ï¼Œ$`q _{\text next} = q + \frac{dq}{dt} dt`$ã¨ã„ã†å½¢ã§åˆæœŸå€¤å•é¡Œã‚’è§£ãã“ã¨ãŒã§ãã‚‹ï¼

[../../include/basic_vectors.hpp#L1539](../../include/basic_vectors.hpp#L1539)



![sample_dQdt.gif](sample_dQdt.gif)

é’ãŒRK1ï¼Œãƒ”ãƒ³ã‚¯ãŒRK2ï¼ç·‘ãŒRK4ï¼
RK1ã¯æ™‚é–“ãŒé€²ã‚€ã«ã¤ã‚Œã¦å¤§ãããªã£ã¦ã„ã‚‹ï¼


[./validateAngularVelocity.cpp#L5](./validateAngularVelocity.cpp#L5)


---
